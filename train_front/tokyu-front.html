<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Tokyu Line</title>
    <style>
      select{
        -webkit-appearance: button;
        -moz-appearance: button;
        appearance: button;
        border-radius:6px;
        width: 200px;
        height: 60px;
        line-height: 60px;
        font-size: 20px;
        text-indent: 1em;
        color: #FFFFFF;
        border: none;
        cursor: pointer;
        background:#888888 url(img/down-arrow.svg) no-repeat;
        background-size:40px 60px;
        background-position: right center;
        content: "Background tex"
      }
      button{
        -webkit-appearance: button;
        -moz-appearance: button;
        appearance: button;
        width: 200px;
        height: 60px;
        line-height: 60px;
        color: #FFFFFF;
        font-size: 20px;
        background:#888888 no-repeat;
        background-size:40px 60px;
      }
    </style>
    <script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>
    <script>//<![CDATA[
      var tts;
      var kind;
      var station;
      $(document).ready(function(){
        $.getJSON("js/tts.json", function(data){
          tts = data;
        });
        $.getJSON("js/kind.json", function(data){
          kind = data;
        });
        $.getJSON("js/station.json", function(data){
          station = data;
        });
        initCar();
      });
      function getKind() {
        return document.getElementById("train_form").kind.value;
      }
      function getKinds() {
        return {
                     express:     {fgcolor: "white", bgcolor: "red",   string: "急行"},
                     semiexpress: {fgcolor: "white", bgcolor: "lime",  string: "準急"},
                     greenlocal:  {fgcolor: "green", bgcolor: "white", string: "各停"},
                     bluelocal:   {fgcolor: "white", bgcolor: "blue",  string: "各停"},
                     local:       {fgcolor: "white", bgcolor: "black", string: "各停"}
        };
      }
      function getKindString() {
        var kinds = getKinds();
        return kinds[getKind()]["string"];
      }
      function getKindFgColor() {
        var kinds = getKinds();
        return kinds[getKind()]["fgcolor"];
      }
      function getKindBgColor() {
        var kinds = getKinds();
        return kinds[getKind()]["bgcolor"];
      }
      function getDest() {
        return document.getElementById("train_form").dest.value;
      }
      function getDestString() {
        return station[getDest()];
      }
      function changeKind() {
        var svg = document.getElementById("train").getSVGDocument();
        if (svg == null) return;

        var kind = getKind();
        svg.getElementById("kind_string").firstChild.firstChild.nodeValue = getKindString();
        svg.getElementById("kind_string").firstChild.style.fill = getKindFgColor();
        svg.getElementById("kind_bg").style.fill = getKindBgColor();
        svg.getElementById("kind_bg").style.stroke = getKindFgColor();
        svg.getElementById("kind_bg").style.strokeWidth = 3;
        svg.getElementById("kind_bg").style.strokeDashArray = 20;
      }
      function changeDest() {
        var svg = document.getElementById("train").getSVGDocument();
        if (svg == null) return;
        var dest = getDestString();
        svg.getElementById("dest_string").firstChild.firstChild.nodeValue = dest;
        var fontSize = 40 / dest.length * 3;
        svg.getElementById("dest_string").firstChild.style.fontSize = fontSize;
      }
      function moveWiper() {
        var svg = document.getElementById("train").getSVGDocument();
        var wipe = '<animateMotion path="M10,0 100,0 10,0" dur="1s" repeatCount="indefinite" />';
        svg.getElementById("wiper").innerHTML = wipe;
      }
      function changeCar() {
        var car = document.getElementById("train_form").car.value;
        document.getElementById("train").setAttribute("src", car + ".svg");
        document.getElementById("train").style.display = "none";
        document.getElementById("train").style.display = "block";
        initCar();
      }
      function initCar() {
        var car = document.getElementById("train_form").car.value;
        document.getElementById("train").setAttribute("src", car + ".svg");
        document.getElementById("train").onload = initCar;
        changeKind();
        changeDest();
        //moveWiper();
      }
      function playSound(sound) {
        var audio = new Audio("audio/"+ sound + ".mp3");
        audio.play();
      }
      function playSounds(snd) {
        sounds = snd;
        current = 0 ;
        var audio = new Audio("audio/"+ sounds[current] + ".mp3");
        audio.play();

        audio.addEventListener('ended',function(e){
          current++;
          if(current < sounds.length) {
            source = "audio/" + sounds[current] + ".mp3";
            this.src = source
            this.pause();
            this.load();
            this.play();
          }
        });
      }
      function sayDeparture() {
        var message = ["kind_general_lead","kind_" + getKind(), getDest(), "dest_general_trail"];
        playSounds(message);
      }
      //]]>
    </script>
  </head>
  <body>
    <form id="train_form">
      <div>
      車両：
        <select name="car" onchange="changeCar()">
          <option value="tokyu-2000-front" selected="slected">2000系</option>
          <option value="oimachi-line-express-front">6000系</option>
          <option value="tokyu-9000-front">9000系</option>
        </select>
      種別：
        <select name="kind" onchange="changeKind()">
          <option value="express">急行</option>
          <option value="semiexpress" selected="slected">準急</option>
          <option value="greenlocal">各停</option>
          <option value="bluelocal">各停</option>
          <option value="local">各停</option>
        </select>
      行き先：
        <select name="dest" onchange="changeDest()">
          <option value="DT27" selected="slected">中央林間</option>
          <option value="DT22" name="長津田" >長津田</option>
          <option value="DT11" name="">梶が谷</option>
          <option value="TS03">押上</option>
          <option value="TI02">久喜</option>
          <option value="TN03">南栗橋</option>
          <option value="DT14">鷺沼</option>
          <option value="OM16">溝の口</option>
          <option value="OM01">大井町</option>
          <option value="OM10">自由が丘</option>
          <option value="OM08">大岡山</option>
        </select>
        <br>
        <button type="button" name="slow_train" value="slow_train" onclick="playSound(this.value)">ゆっくり走る</button>
        <button type="button" name="fast_train" value="fast_train" onclick="playSound(this.value)">速く走る</button>
        <button type="button" name="crossing" value="crossing" onclick="playSound(this.value)">踏切</button>
        <button type="button" name="say_departure" value="" onclick="sayDeparture()">出発</button>
      </div>
    </form>
    <embed src="tokyu-2000-front.svg" type="image/svg+xml" id="train" />
    <div style="display: none" id="audios"></div>
    <div><a href="http://www.senses-circuit.com/">音源：フリー音楽素材 Senses Circuit</a></div>
  </body>
</html>
